var apiVersion="41.0",requestMetadata=[],requestSqlData=[{type:"ApexClass",table:"ApexClass_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"ApexPage",table:"ApexPage_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"ApexTrigger",table:"ApexTrigger_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"ApexComponent",table:"ApexComponent_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"StaticResource",table:"StaticResource_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"WebLink",table:"WebLink_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate, PageOrSobjectType",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","PageOrSobjectType","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:[3,2]},{type:"Dashboard",table:"Dashboard_tb",soqlFields:"Id, Title, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Title","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"Report",table:"Report_tb",soqlFields:"Id, Name, DeveloperName,LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","DeveloperName","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:3},{type:"RecordType",table:"RecordType_tb",soqlFields:"Id, SobjectType, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate, DeveloperName",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","SobjectType","Name","DeveloperName","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:[2,4]},{type:"ActionLinkGroupTemplate",table:"ActionLinkGroupTemplate_tb",soqlFields:"Id, MasterLabel, DeveloperName, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"Id != null",fields:["Select","Id","MasterLabel","DeveloperName","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:3}];function __getCookie(e){var t,a,r,i=document.cookie.split(";");for(t=0;t<i.length;t++)if(a=i[t].substr(0,i[t].indexOf("=")),r=i[t].substr(i[t].indexOf("=")+1),(a=a.replace(/^\s+|\s+$/g,""))==e)return unescape(r)}var filterBy="LastModifiedDate",filterByMetadata="lastModifiedDate",sforce=new jsforce.Connection({serverUrl:getServerURL(),sessionId:__getCookie("sid")});function changefilterMode(e,t){filterBy=e,filterByMetadata=t}function getServerURL(){var e=window.location.href.split("/");return e[0]+"//"+e[2]}var blobToBase64=function(e,t){var a=new FileReader;a.onload=function(){var e=a.result.split(",")[1];t(e)},a.readAsDataURL(e)};function addRow(e,t,a){jQuery(a).append("<tr/>"),t.map(function(t){return"Select"==t?jQuery('<td><span aria-hidden="true" class="glyphicon glyphicon-unchecked"></span></td>'):"null"==e[t]||null==e[t]?jQuery("<td></td>"):isDate(e[t])?jQuery("<td>"+showDate(e[t])+"<br/>("+moment(new Date(e[t])).fromNow()+")</td>"):"string"==typeof e[t]?jQuery("<td>"+e[t]+"</td>"):jQuery("<td>"+e[t].Name+"</td>")}).forEach(function(e){jQuery(a).find("tr:last").append(e)})}function isDate(e){var t=new Date(e);return!isNaN(t.valueOf())}function showDate(e){var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1,i=t.getDate();return r<10&&(r="0"+r),i<10&&(i="0"+i),a+"-"+r+"-"+i}function createPanel(e,t,a){jQuery(a).append('<li><a href="#'+jQuery(t).attr("Id")+'-tab" role="tab" data-toggle="tab">'+e+"</a></li>");var r=jQuery('<div class="tab-pane" id="'+jQuery(t).attr("Id")+'-tab"/>'),i=jQuery('<div class="panel panel-default"/>');return jQuery(i).append('<div class="panel-heading"> '+e+"</div>"),jQuery(i).append('<div class="panel-body"></div>'),jQuery(i).find(".panel-body").append(jQuery(t)),jQuery(r).append(jQuery(i)),jQuery(r)}function createTable(e,t){var a=jQuery('<table id="'+t+'" cellpadding="0" border="0" class="table table-striped table-bordered" cellspacing="0" width="100%"></table>');for(jQuery(a).append("<thead></thead>"),jQuery(a).append("<tbody></tbody>"),jQuery(a).find("thead").append("<tr/>"),i=0;i<e.length;i++)"Select"==e[i]?jQuery(a).find("tr:last").append('<td><input type="checkbox" onclick="selectAll(this,\''+t+"','')\"/></td>"):jQuery(a).find("thead>tr").append("<th>"+e[i]+"</th>");return jQuery(a)}function selectAll(e,t,a){var r=(""!=t?jQuery("#"+t).dataTable():jQuery(a).dataTable()).fnGetNodes();jQuery(r).each(function(){""==e||jQuery(e).is(":checked")?(jQuery(this).addClass("selected"),jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check")):(jQuery(this).removeClass("selected"),jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked"))})}function globalSelectAll(){requestMetadata.forEach(function(e,t){selectAll("","",jQuery("#"+e.table))}),requestSqlData.forEach(function(e,t){selectAll("","",jQuery("#"+e.table))})}function globalUnSelectAll(){requestMetadata.forEach(function(e,t){selectAll(" ","",jQuery("#"+e.table))}),requestSqlData.forEach(function(e,t){selectAll(" ","",jQuery("#"+e.table))})}function waitForDone(e){function t(a){var r;a[0].getBoolean("done")?(r=a[0].id,sforce.metadata.checkRetrieveStatus(r,e)):sforce.metadata.checkStatus([a[0].id],t)}return function(e){t([e])}}function maketypeblock(e,t,a){var r="";return jQuery(e).DataTable().rows(".selected").data().length>0&&(r+="\n    <types>",jQuery(jQuery(e).DataTable().rows(".selected").data()).each(function(){jQuery(this);if(r+="\n        <members>","number"==typeof t)""!=jQuery(this)[t]&&"null"!=jQuery(this)[t]&&null!=jQuery(this)[t]&&(r+=jQuery(this)[t]);else for(i=0;i<t.length;i++)""!=jQuery(this)[t[i]]&&"null"!=jQuery(this)[t[i]]&&null!=jQuery(this)[t[i]]&&(i!=t.length-1?r+=jQuery(this)[t[i]]+".":r+=jQuery(this)[t[i]]);r+="</members>"}),r+=" \n       <name>"+a+"</name>",r+=" \n   </types>"),r}function makeobjectToRetrive(e,t,a){var r;return jQuery(e).DataTable().rows(".selected").data().length>0&&(r={name:a,members:[]},jQuery(jQuery(e).DataTable().rows(".selected").data()).each(function(){if("number"==typeof t)""!=jQuery(this)[t]&&"null"!=jQuery(this)[t]&&null!=jQuery(this)[t]&&r.members.push(jQuery(this)[t]);else for(i=0;i<t.length;i++){var e="";""!=jQuery(this)[t[i]]&&"null"!=jQuery(this)[t[i]]&&null!=jQuery(this)[t[i]]&&(i!=t.length-1?e+=jQuery(this)[t[i]]+".":e+=jQuery(this)[t[i]]),r.members.push(e)}})),r}function getPackage(){showLoading();var e=[];requestMetadata.forEach(function(t,a){var r=makeobjectToRetrive(jQuery("#"+t.table),t.apiFieldIndex,t.type);void 0!==r&&e.push(r)}),requestSqlData.forEach(function(t,a){var r=makeobjectToRetrive(jQuery("#"+t.table),t.apiFieldIndex,t.type);void 0!==r&&e.push(r)}),e.length>0?sforce.metadata.retrieve({unpackaged:{types:e,version:apiVersion}}).complete(function(e,t){e&&console.error(e),console.log("ready for download.."),location.href="data:application/zip;base64,"+t.zipFile,hideLoading()}):(alert("No Resource selected..."),hideLoading())}function deploy(){alert("Coming Sooooon.")}function startChangeSetWorker(){var e=jQuery("#changeSetName").val(),t=jQuery("#changeSetDescription").val();if(e.trim().length>0){jQuery("#changeSetDialog").modal("hide");var a=[],r={};requestMetadata.forEach(function(e,t){var i;"Profile"!=e.type?void 0!==(i=makeobjectToRetrive(jQuery("#"+e.table),1,e.type))&&a.push(i):void 0!==(i=makeobjectToRetrive(jQuery("#"+e.table),1,e.type))&&(r=i)}),requestSqlData.forEach(function(e,t){var r=makeobjectToRetrive(jQuery("#"+e.table),1,e.type);void 0!==r&&a.push(r)}),localStorage.setItem("changeSetName",e),localStorage.setItem("changeSetDescription",t),localStorage.setItem("changeSet",JSON.stringify(a)),localStorage.setItem("profiles",JSON.stringify(r)),localStorage.setItem("processStatus","1"),localStorage.setItem("DoneChangeSet",JSON.stringify([])),window.open(window.location.protocol+"//"+window.location.host+"/changemgmt/createOutboundChangeSet.apexp?auto=1","_blank")}else jQuery("#changeSetName-form-group").addClass("has-error")}function createChangeSet(){var e=[];requestMetadata.forEach(function(t,a){if("Profile"!=t.type){var r=makeobjectToRetrive(jQuery("#"+t.table),1,t.type);void 0!==r&&e.push(r)}}),requestSqlData.forEach(function(t,a){var r=makeobjectToRetrive(jQuery("#"+t.table),1,t.type);void 0!==r&&e.push(r)}),e.length>0?jQuery("#changeSetDialog").modal({backdrop:"static",keyboard:!0}):ezBSAlert({messageText:"Please select resource before this action.",alertType:"danger"})}function loginUser(){var e=[];requestMetadata.forEach(function(t,a){var r=makeobjectToRetrive(jQuery("#"+t.table),t.apiFieldIndex,t.type);void 0!==r&&e.push(r)}),requestSqlData.forEach(function(t,a){var r=makeobjectToRetrive(jQuery("#"+t.table),t.apiFieldIndex,t.type);void 0!==r&&e.push(r)});sforce.metadata.retrieve({unpackaged:{types:e,version:apiVersion}}).complete(function(e,t){e&&console.error(e),console.log("ready for download..");var a=new Blob([t.zipFile],{type:"application/zip"});blobToBase64(a,function(e){var t=new File([e],"package.zip",{type:"application/zip"});console.log("File object created:",t);var a=new FormData;a.append("file",t),fetch("http://localhost:3000/upload",{method:"POST",body:a}).then(function(e){return e.json()}).then(console.log).catch(console.error)})})}function generateXml(){var e='<?xml version="1.0" encoding="UTF-8"?>';e+='\n<Package xmlns="http://soap.sforce.com/2006/04/metadata">',requestMetadata.forEach(function(t,a){e+=maketypeblock(jQuery("#"+t.table),t.apiFieldIndex,t.type)}),requestSqlData.forEach(function(t,a){e+=maketypeblock(jQuery("#"+t.table),t.apiFieldIndex,t.type)}),e+="\n    <version>"+apiVersion+"</version>\n</Package>",jQuery("#xmlData").val(e),jQuery("#xmlDialog").modal()}function updateData(){showLoading(),setTimeout(function(){jQuery("#container").html(""),jQuery("#container-tab2").html(""),jQuery("#container-tab").html(""),workWithSOQL().then(function(){return workWithSessionStorageMetaData()}).then(function(){jQuery('#myTab a[href="#'+requestSqlData[0].type+'_tb-tab"]').tab("show"),hideLoading()}).catch(function(e){console.error("Error",e)})},200)}function workWithSOQL(){var e="2015-12-10";""!=jQuery("#dateField").val()&&(e=convertDate(jQuery("#dateField").val()));var t=requestSqlData.map(function(t){var a="Select "+t.soqlFields+" From "+t.type+" where ";return a+=""!=e?filterBy+" >= "+e+" AND ":"",a+=" "+t.soqlWhere+" order by "+filterBy+" desc",sforce.query(a)});return Promise.all(t).then(function(e){return e.forEach(function(e,t){var a=e.records;if(a&&a.length>0){var r,i;i=createTable(requestSqlData[t].fields,requestSqlData[t].table),r=createPanel(requestSqlData[t].type,i,jQuery("#container-tab"));for(var o=0;o<a.length;o++)addRow(a[o],requestSqlData[t].fields,jQuery(i).find("tbody"));jQuery("#container").append(jQuery(r)),jQuery("#"+requestSqlData[t].table).DataTable({order:[[requestSqlData[t].fields.indexOf("LastModifiedDate"),"desc"]],iDisplayLength:100}),jQuery("#"+requestSqlData[t].table+" tbody").on("click","tr",function(){jQuery(this).toggleClass("selected"),jQuery(this).hasClass("selected")?jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check"):jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked")})}}),Promise.resolve()}).catch(function(e){return Promise.reject(e)})}function workWithSessionStorageMetaData(){var e=["Select","id","fullName","fileName","lastModifiedDate","lastModifiedByName","createdDate","createdByName"],t="2015-12-10";return""!=jQuery("#dateField").val()&&(t=new Date(jQuery("#dateField").val())),requestMetadata.forEach(function(a){var r=JSON.parse(sessionStorage.getItem(a.type));if(r&&r.length>0){var i,o;o=createTable(e,a.table);var n=!1;r.forEach(function(a){"installed"!=a.manageableState&&(""==t||t<new Date(a[filterByMetadata]))&&(addRow(a,e,jQuery(o).find("tbody")),n=!0)}),n&&(i=createPanel(a.type,o,jQuery("#container-tab2")),jQuery("#container").append(jQuery(i)),jQuery("#"+a.table).DataTable({order:[[e.indexOf("lastModifiedDate"),"desc"]],iDisplayLength:100}),jQuery("#"+a.table+" tbody").on("click","tr",function(){jQuery(this).toggleClass("selected"),jQuery(this).hasClass("selected")?jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check"):jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked")}))}}),Promise.resolve()}function workWithMetaData(){var e=["Select","id","fullName","fileName","lastModifiedDate","lastModifiedByName","createdDate","createdByName"],t="2015-12-10";""!=jQuery("#dateField").val()&&(t=new Date(jQuery("#dateField").val()));var a=requestMetadata.map(function(e){var t=[{type:e.type}];return sforce.metadata.list(t,apiVersion)});return Promise.all(a).then(function(a){return a.forEach(function(a,r){if(a&&a.length>0){var i,o;sessionStorage.setItem(requestMetadata[r].type,JSON.stringify(a)),o=createTable(e,requestMetadata[r].table);var n=!1;a.forEach(function(a){"installed"!=a.manageableState&&(""==t||t<new Date(a[filterByMetadata]))&&(addRow(a,e,jQuery(o).find("tbody")),n=!0)}),n&&(i=createPanel(requestMetadata[r].type,o,jQuery("#container-tab2")),jQuery("#container").append(jQuery(i)),jQuery("#"+requestMetadata[r].table).DataTable({order:[[e.indexOf("lastModifiedDate"),"desc"]],iDisplayLength:100}),jQuery("#"+requestMetadata[r].table+" tbody").on("click","tr",function(){jQuery(this).toggleClass("selected"),jQuery(this).hasClass("selected")?jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check"):jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked")}))}else sessionStorage.removeItem(requestMetadata[r].type)}),Promise.resolve()}).catch(function(e){return Promise.reject(e)})}function convertDate(e){if(void 0!==e){var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1,i=t.getDate();return r<10&&(r="0"+r),i<10&&(i="0"+i),a+"-"+r+"-"+i+"T00:00:00Z"}return""}function showLoading(){jQuery("#status").hasClass("show")||(jQuery("#status").addClass("show"),jQuery("#status").show(),jQuery("#preloader").show())}function hideLoading(){jQuery("#status").removeClass("show"),jQuery("#status").hide(),jQuery("#preloader").hide()}jQuery(function(){showLoading(),jQuery("#dateField").val(showDate((new Date).add(-1).month())),console.log("Ready for API fun!"),sforce.metadata.describe(apiVersion).then(function(e){return e.metadataObjects.forEach(function(e){e.childXmlNames&&e.childXmlNames.forEach(function(e){0==requestSqlData.filter(function(t){return t.type.toLowerCase()===e.toLowerCase()}).length&&requestMetadata.push({type:e,table:e+"_tb",apiFieldIndex:2})}),0==requestSqlData.filter(function(t){return t.type.toLowerCase()===e.xmlName.toLowerCase()}).length&&requestMetadata.push({type:e.xmlName,table:e.xmlName+"_tb",apiFieldIndex:2})}),requestMetadata=requestMetadata.sort(function(e,t){return e.type<t.type?-1:e.type>t.type?1:0}),workWithSOQL()}).then(function(){return workWithMetaData()}).then(function(){jQuery('#myTab a[href="#'+requestSqlData[0].type+'_tb-tab"]').tab("show"),hideLoading()}).catch(function(e){console.error("Error",e)}),jQuery("#dateField").datepicker({format:"yyyy-mm-dd"})});
//# sourceMappingURL=app.min.js.map
