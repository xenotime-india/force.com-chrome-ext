function Communicator(){this.handlers={},this.addListeners()}Communicator.prototype.addListeners=function(){chrome.extension.onRequest.addListener(function(n,t,o){t.tab&&communicator.handleMessage(n,t.tab.id,o)}),chrome.windows.onRemoved.addListener(function(n){for(var t in communicator.handlers){var o,e=communicator.handlers[t].length,a=[];for(o=0;o<e;o++)communicator.handlers[t][o].win_id==n&&a.push(communicator.handlers[t][o].handler);for(o=0;o<a.length;o++)communicator.unregisterHandler(t,a[o])}})},Communicator.prototype.registerHandler=function(n,t,o){n in this.handlers||(this.handlers[n]=[]),this.handlers[n].push({handler:t,win_id:o})},Communicator.prototype.unregisterHandler=function(n,t){if(n in this.handlers)for(var o=0;o<this.handlers[n].length;o++)if(this.handlers[n][o].handler==t){this.handlers[n].splice(o,1);break}},Communicator.prototype.handleMessage=function(n,t,o){n.topic in this.handlers&&chrome.tabs.get(t,function(e){e&&communicator.handlers[n.topic].forEach(function(a){return a.win_id&&a.win_id==e.windowId?void a.handler(n.data,t,o):(a.handler(n.data,t),void(o&&o()))})})},Communicator.prototype.postMessage=function(n,t,o,e,a){chrome.tabs.sendRequest(o,{topic:n,data:t,_frame:a},e)},Communicator.prototype.sendMessage=function(n,t,o,e){return new Promise(function(a,i){chrome.tabs.sendMessage(o,{topic:n,data:t,_frame:e},a)})},Communicator.prototype.broadcastMessage=function(n,t,o){o?chrome.tabs.getAllInWindow(o,function(o){o&&o.forEach(function(o){chrome.tabs.sendRequest(o.id,{topic:n,data:t},function(){})})}):chrome.windows.getLastFocused(function(o){o.tabs.forEach(function(o){chrome.tabs.sendRequest(o.id,{topic:n,data:t},function(){})})})};var communicator=new Communicator;
//# sourceMappingURL=communicator.min.js.map
